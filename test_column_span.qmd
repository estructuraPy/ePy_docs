---
title: "Test Column Span Features"
format: 
  html: default
  pdf: default
jupyter: python3
---

# Test de Column Span y TOC

Este documento prueba las nuevas funcionalidades:

1. **Paper y presentation sin TOC** 
2. **Parámetro column_span** en add_image, add_plot, add_table, add_colored_table
3. **Ajuste automático de ancho** basado en columnas del documento

```{python}
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
from ePy_docs import DocumentWriter

# Crear datos de prueba
np.random.seed(42)
data = {
    'Material': ['Steel', 'Aluminum', 'Concrete', 'Wood', 'Plastic'],
    'Stress_MPa': [250, 180, 30, 25, 15],
    'Strain': [0.002, 0.003, 0.001, 0.004, 0.008],
    'Young_Modulus_GPa': [200, 70, 25, 12, 3]
}
df = pd.DataFrame(data)

# Test con paper (sin TOC)
writer_paper = DocumentWriter("paper", layout_style="academic")

writer_paper.add_h1("Test Paper Document - Sin TOC")
writer_paper.add_text("Este documento tipo paper NO debe mostrar tabla de contenidos.")

# Test con presentation (sin TOC) 
writer_presentation = DocumentWriter("presentation", layout_style="minimal")
writer_presentation.add_h1("Test Presentation - Sin TOC")
writer_presentation.add_text("Este documento tipo presentation NO debe mostrar tabla de contenidos.")

# Test con report (con TOC - comportamiento normal)
writer_report = DocumentWriter("report", layout_style="classic") 
writer_report.add_h1("Test Report - Con TOC")
writer_report.add_text("Este documento tipo report SÍ debe mostrar tabla de contenidos.")

print("✅ Documentos creados sin errores")
```

```{python}
# Test column_span en add_image
fig, ax = plt.subplots(figsize=(8, 4))
ax.bar(df['Material'], df['Stress_MPa'], color='steelblue')
ax.set_title('Stress by Material')
ax.set_ylabel('Stress (MPa)')
plt.xticks(rotation=45)
plt.tight_layout()

# Guardar figura temporal para test de add_image
plt.savefig('temp_figure.png', dpi=150, bbox_inches='tight')
plt.close()

# Test add_image con column_span
writer_report.add_h2("Test add_image con column_span")
writer_report.add_image("temp_figure.png", 
                       caption="Imagen con column_span=1.0 (una columna)", 
                       column_span=1.0)

print("✅ add_image con column_span funcionando")
```

```{python}
# Test add_plot con column_span
fig, ax = plt.subplots(figsize=(6, 4))
materials = df['Material']
stress = df['Stress_MPa']
strain = df['Strain']

ax.scatter(strain, stress, s=100, alpha=0.7, c='red')
ax.set_xlabel('Strain')
ax.set_ylabel('Stress (MPa)')
ax.set_title('Stress vs Strain')

# Test add_plot con column_span - debe ajustar automáticamente el tamaño
writer_report.add_h2("Test add_plot con column_span")
writer_report.add_plot(fig, 
                      title="Plot con column_span=2.0 (dos columnas)",
                      caption="El gráfico se debe ajustar automáticamente al ancho", 
                      column_span=2.0)

print("✅ add_plot con column_span funcionando")
```

```{python}
# Test add_table con column_span
writer_report.add_h2("Test add_table con column_span")
writer_report.add_table(df, 
                       title="Tabla con column_span=1.5 (1.5 columnas)",
                       column_span=1.5)

print("✅ add_table con column_span funcionando")
```

```{python}
# Test add_colored_table con column_span
writer_report.add_h2("Test add_colored_table con column_span")
writer_report.add_colored_table(df, 
                               title="Tabla coloreada con column_span=2.0 (dos columnas)",
                               highlight_columns=['Stress_MPa', 'Young_Modulus_GPa'],
                               palette_name='blues',
                               column_span=2.0)

print("✅ add_colored_table con column_span funcionando")
```

```{python}
# Generar documentos
print("Generando documentos...")

try:
    writer_paper.generate("test_paper_no_toc")
    print("✅ Paper sin TOC generado")
except Exception as e:
    print(f"❌ Error paper: {e}")

try:
    writer_presentation.generate("test_presentation_no_toc") 
    print("✅ Presentation sin TOC generado")
except Exception as e:
    print(f"❌ Error presentation: {e}")

try:
    writer_report.generate("test_report_column_span")
    print("✅ Report con column_span generado")
except Exception as e:
    print(f"❌ Error report: {e}")

print("✅ Tests completados!")
```